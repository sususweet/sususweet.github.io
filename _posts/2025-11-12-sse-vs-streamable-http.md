---
layout: post
title: MCP ä¼ è¾“æœºåˆ¶è¯¦è§£ï¼šä» HTTP+SSE åˆ° Streamable HTTP
categories: [web]
description: MCP ä¼ è¾“æœºåˆ¶è¯¦è§£ï¼šä» HTTP+SSE åˆ° Streamable HTTP
keywords: MCP, SSE, Streamable HTTP
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---

å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼ŒMCP çš„å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„é€šä¿¡ï¼Œéœ€éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

* **æ¶ˆæ¯æ ¼å¼**ï¼šæ‰€æœ‰ MCP æ¶ˆæ¯éƒ½å¿…é¡»æ˜¯ JSON-RPC æ ¼å¼ï¼›æ‰€æœ‰ JSON-RPC æ¶ˆæ¯å¿…é¡»ä½¿ç”¨ UTF-8 ç¼–ç ã€‚

* **ä¸¤ç§æ ‡å‡†åŒ–çš„ä¼ è¾“æ–¹å¼**ï¼šstdio (æ ‡å‡†è¾“å…¥/è¾“å‡º)ã€Streamable HTTPÂ ã€‚åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯åº”å½“æ”¯æŒæ ‡å‡†è¾“å…¥è¾“å‡º (stdio)ã€‚

* å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡æ¨¡å—åŒ–çš„æ–¹å¼å®ç°è‡ªå®šä¹‰çš„ä¼ è¾“æœºåˆ¶ã€‚

åœ¨ MCP åè®® 2025-03-26 ç‰ˆæœ¬ï¼ŒStreamable HTTP æ›¿ä»£äº†ä¹‹å‰ç‰ˆæœ¬ï¼ˆ2024-11-05 ç‰ˆï¼‰çš„ä¼ è¾“æ–¹å¼ï¼šHTTP+SSE ã€‚ä¸‹é¢åˆ†åˆ«è¯¦ç»†ä»‹ç»ä¸‰ç§ä¼ è¾“æœºåˆ¶ï¼š**stdioã€HTTP+SSEã€Streamable HTTP**ã€‚

#### stdioï¼ˆæ ‡å‡†è¾“å…¥/è¾“å‡ºï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šé€‚åˆæœ¬åœ°è¿è¡Œçš„ MCP æœåŠ¡å™¨ï¼ˆå¦‚æ¡Œé¢åº”ç”¨ Claude Desktopï¼‰ï¼›é€‚åˆ MCP æœåŠ¡å™¨çš„å¼€å‘è°ƒè¯•ã€‚

**å…³é”®ç‰¹æ€§**ï¼š

* **å®¢æˆ·ç«¯ç›´æ¥å¯åŠ¨å¹¶ç®¡ç†æœåŠ¡å™¨è¿›ç¨‹**ã€‚

* **é»˜è®¤ç¯å¢ƒéš”ç¦»**ï¼ˆä¸ç»§æ‰¿ shell ç¯å¢ƒå˜é‡ï¼‰ï¼Œéœ€æ˜¾å¼ä¼ é€’æ•æ„Ÿæ•°æ®ï¼ˆå¦‚ API Keyï¼‰ã€‚

* **æ”¯æŒä¼šè¯æŒä¹…åŒ–**ã€‚

**é€šä¿¡å·¥ä½œæµç¨‹**

* å®¢æˆ·ç«¯å°† MCP æœåŠ¡å™¨ä½œä¸ºå­è¿›ç¨‹å¯åŠ¨ã€‚

* æœåŠ¡å™¨ä»å…¶æ ‡å‡†è¾“å…¥ (stdin) è¯»å– JSON-RPC æ¶ˆæ¯ï¼Œå¹¶å°†å…¶æ¶ˆæ¯å‘é€åˆ°å…¶æ ‡å‡†è¾“å‡º (stdout)ã€‚

* æ¶ˆæ¯æ˜¯å•ç‹¬çš„ JSON-RPC è¯·æ±‚ã€é€šçŸ¥æˆ–å“åº”ã€‚

* æ¶ˆæ¯é€šè¿‡æ¢è¡Œç¬¦ (\\n) åˆ†éš”ï¼Œä¸”æ¶ˆæ¯å†…å®¹ä¸­ç¦æ­¢åŒ…å«å†…åµŒçš„æ¢è¡Œç¬¦ã€‚

* æœåŠ¡å™¨å¯å°†å…¶æ ‡å‡†é”™è¯¯ (stderr) ç”¨äºè¾“å‡º UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä»¥è¾¾åˆ°æ—¥å¿—è®°å½•ç›®çš„ã€‚å®¢æˆ·ç«¯å¯æ•è·ã€è½¬å‘æˆ–å¿½ç•¥æ­¤æ—¥å¿—è®°å½•ã€‚

* æœåŠ¡å™¨ä¸å¾—å‘å…¶ stdout å†™å…¥ä»»ä½•éæœ‰æ•ˆçš„ MCP æ¶ˆæ¯çš„å†…å®¹ã€‚

* å®¢æˆ·ç«¯ä¸å¾—å‘æœåŠ¡å™¨çš„ stdin å†™å…¥ä»»ä½•éæœ‰æ•ˆçš„ MCP æ¶ˆæ¯çš„å†…å®¹ã€‚

![å›¾ç‰‡](/images/posts/mcp/1.png)

#### ä» HTTP+SSE åˆ° Streamable HTTP

åœ¨ MCP åè®® 2025-03-26 ç‰ˆæœ¬ï¼ŒStreamable HTTP æ›¿ä»£äº†ä¹‹å‰ç‰ˆæœ¬ï¼ˆ2024-11-05 ç‰ˆï¼‰çš„ä¼ è¾“æ–¹å¼ï¼šHTTP+SSE transportï¼ˆhttps://modelcontextprotocol.io/specification/2024-11-05/basic/transportsï¼‰

ä¸ºä»€ä¹ˆè¦ä» HTTP+SSE è½¬åˆ° Streamable HTTP å‘¢ï¼Ÿ

![å›¾ç‰‡](/images/posts/mcp/2.png)

* **HTTP+SSE**ï¼š å®¢æˆ·ç«¯é€šè¿‡ HTTP POST å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ SSE (Server-Sent Events) ç«¯ç‚¹æ¨é€å“åº”ï¼Œéœ€è¦ç»´æŠ¤ä¸¤ä¸ªç‹¬ç«‹çš„è¿æ¥ã€‚

* **Streamable HTTP**ï¼š å®ƒä½¿ç”¨å•ä¸€çš„ HTTP ç«¯ç‚¹ç»Ÿä¸€å¤„ç†è¯·æ±‚å’Œå“åº”ï¼Œå…è®¸æœåŠ¡å™¨æ ¹æ®éœ€è¦é€‰æ‹©è¿”å›æ ‡å‡† HTTP å“åº”æˆ–å¯ç”¨ SSE æµã€‚

##### HTTP+SSE

HTTP+SSE çš„å·¥ä½œæµç¨‹ï¼š

1. å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ª "http://example.com/sse" ç«¯ç‚¹

2. æœåŠ¡å™¨å“åº”ä¸€ä¸ª "endpoint event"ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯ä½¿ç”¨å“ªä¸ª URIï¼ˆä¾‹å¦‚ http://example.com/messages ï¼‰ æ¥å‘é€æ¶ˆæ¯

3. å®¢æˆ·ç«¯ä½¿ç”¨æ­¤ URI ä¸æœåŠ¡å™¨é€šä¿¡

4. æœåŠ¡å™¨é€šè¿‡ SSE åè®®ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚

> SSEï¼ˆServer-Sent Eventsï¼‰æ˜¯ä¸€ç§ç”¨äºå®ç°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„æŠ€æœ¯ï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œäº‹ä»¶æµâ€ï¼ˆEvent Streamï¼‰ã€‚å®ƒåŸºäº HTTP åè®®ï¼Œåˆ©ç”¨äº†å…¶é•¿è¿æ¥ç‰¹æ€§ï¼Œåœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€æ¡æŒä¹…åŒ–è¿æ¥ï¼Œå¹¶é€šè¿‡è¿™æ¡è¿æ¥å®ç°æœåŠ¡å™¨å‘å®¢æˆ·ç«¯çš„å®æ—¶æ•°æ®æ¨é€ã€‚

![å›¾ç‰‡](/images/posts/mcp/3.png)

**HTTP+SSE çš„å­˜åœ¨çš„é—®é¢˜**ï¼š

* **è¿æ¥çš„ç»´æŠ¤æˆæœ¬é«˜**ï¼šéœ€è¦ç»´æŠ¤ä¸¤ä¸ªç‹¬ç«‹çš„è¿æ¥/ç«¯ç‚¹ï¼ˆendpointï¼‰ã€‚

* **èµ„æºæ¶ˆè€—é«˜**ï¼šå¿…é¡»ä¿æŒé•¿è¿æ¥ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´æ˜¾è‘—çš„èµ„æºæ¶ˆè€—ã€‚é•¿è¿æ¥ä¹Ÿä½¿å¾—æ— çŠ¶æ€å®ç°å˜å¾—å›°éš¾ã€‚

* **åŸºç¡€è®¾æ–½å…¼å®¹æ€§å·®**ï¼šè®¸å¤šç°æœ‰ç½‘ç»œåŸºç¡€è®¾æ–½å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†é•¿æœŸçš„ SSE è¿æ¥ã€‚ä¼ä¸šé˜²ç«å¢™å¯èƒ½ä¼šå¼ºåˆ¶ç»ˆæ­¢è¶…æ—¶çš„è¿æ¥ï¼Œä½¿å¾—æœåŠ¡å˜å¾—ä¸å¯é ã€‚

* **è¿æ¥çš„å¯æ¢å¤æ€§å·®**ï¼šåœ¨ç½‘ç»œé—®é¢˜çš„æƒ…å†µä¸‹ç¼ºä¹è¿æ¥çš„å¯æ¢å¤æ€§ã€‚è¿™ç»™éœ€è¦é€šè¿‡äº’è”ç½‘è®¿é—®ã€å¯èƒ½é¢ä¸´è¿æ¥ä¸­æ–­çš„è¿œç¨‹ MCP æœåŠ¡å™¨å¸¦æ¥äº†æŒ‘æˆ˜ã€‚

**HTTP+SSE éœ€è¦ç»´æŠ¤ä¸¤ä¸ªç‹¬ç«‹çš„è¿æ¥**ï¼š

![å›¾ç‰‡](/images/posts/mcp/4.png)

##### Streamable HTTP

**Streamable HTTP æ˜¯ MCP åè®®å®šä¹‰çš„ä¸€ç§ç‰¹å®šçš„ã€åŸºäº HTTP çš„ä¼ è¾“æœºåˆ¶æˆ–æ¨¡å¼**ã€‚Streamable HTTP æè¿°äº†å¦‚ä½•åˆ©ç”¨ HTTPï¼ˆç‰¹åˆ«æ˜¯ POST å’Œ GET æ–¹æ³•ï¼‰å’Œå¯é€‰çš„ SSE æŠ€æœ¯ï¼Œåœ¨ MCP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°åŒå‘çš„ã€å¯å…·å¤‡æµå¼äº¤äº’èƒ½åŠ›çš„æ¶ˆæ¯äº¤æ¢ã€‚

**Streamable HTTP çš„å·¥ä½œæµç¨‹**ï¼š

1. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ã€‚

2. æœåŠ¡ç«¯è‡ªå·±å†³å®šæ˜¯ä»¥æ ‡å‡†çš„ HTTP å“åº”ï¼ˆHTTP Responseï¼‰è¿˜æ˜¯æµå¼å“åº”ï¼ˆSSE Responseï¼‰çš„å½¢å¼è¿”å›ã€‚

æœåŠ¡ç«¯è‡ªå·±å†³å®šå“åº”çš„å½¢å¼ï¼ˆHTTP Response æˆ– SSE Responseï¼‰ï¼š

![å›¾ç‰‡](/images/posts/mcp/5.png)

**Streamable HTTP ä¸ HTTP+SSE çš„åŒºåˆ«ï¼Ÿ**

**åœ¨ä¹‹å‰çš„ HTTP+SSE ä¼ è¾“ä¸­**ï¼š

* å®¢æˆ·ç«¯ä¼šè¿æ¥åˆ°ä¸€ä¸ªä¸“ç”¨çš„ /sse ç«¯ç‚¹ï¼Œè¯¥ç«¯ç‚¹ä¸“é—¨ç”¨äºæ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯ã€‚

* æœåŠ¡å™¨ä¼šç«‹å³å‘å›ä¸€ä¸ªâ€œç«¯ç‚¹äº‹ä»¶ (endpoint event)â€ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªä¾›å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„ URLã€‚

* éœ€è¦ç»´æŠ¤ä¸¤ä¸ªç‹¬ç«‹çš„è¿æ¥ï¼šä¸€ä¸ªç”¨äºå®¢æˆ·ç«¯â†’æœåŠ¡å™¨ (HTTP POST)ï¼Œå¦ä¸€ä¸ªç”¨äº æœåŠ¡å™¨â†’å®¢æˆ·ç«¯ (SSE)ã€‚

**åœ¨æ–°çš„ Streamable HTTP ä¼ è¾“ä¸­**ï¼š

* åªæœ‰ä¸€ä¸ªç«¯ç‚¹ï¼ˆé€šå¸¸æ˜¯ /messageï¼‰ã€‚

* ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚éƒ½å¯ä»¥ç”¨æ ‡å‡†çš„ HTTP å“åº”æˆ–å‡çº§çš„ SSE æµæ¥å“åº”ã€‚

* è¿™ç§å‡çº§æ˜¯åŠ¨æ€å‘ç”Ÿçš„ï¼ŒåŸºäºæœåŠ¡å™¨å¯¹è¯¥ç‰¹å®šäº¤äº’çš„éœ€æ±‚ã€‚

* å®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ªæ ‡å‡†çš„ HTTP è¯·æ±‚å‘èµ·è¿æ¥ï¼Œç”±æœåŠ¡å™¨å†³å®šæ˜¯å¦å¯¹å…¶è¿›è¡Œâ€œæµå¼å“åº”â€ã€‚

**Streamable HTTP çš„ä¼˜åŠ¿ï¼š**

**1ã€ğŸŒç»Ÿä¸€çš„ç«¯ç‚¹è®¾è®¡**

Streamable HTTP ç§»é™¤äº†ç”¨äºå»ºç«‹è¿æ¥çš„ä¸“ç”¨ /sse ç«¯ç‚¹ï¼Œå°†æ‰€æœ‰é€šä¿¡é›†æˆåˆ°ä¸€ä¸ªå•ä¸€ç«¯ç‚¹ä¸­ã€‚è¿™ç§è®¾è®¡çš„å¥½å¤„åŒ…æ‹¬ï¼š

* **ç®€åŒ–çš„æ¶æ„**ï¼šå‡å°‘äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ•°é‡ï¼Œé™ä½äº†ç³»ç»Ÿå¤æ‚æ€§ã€‚

* **æ›´ä½çš„èµ„æºæ¶ˆè€—**ï¼šå•ä¸€è¿æ¥ç®¡ç†æ›´é«˜æ•ˆï¼Œå‡å°‘äº†æœåŠ¡å™¨èµ„æºä½¿ç”¨ã€‚

* **æ”¹è¿›çš„å…¼å®¹æ€§**ï¼šæ›´å¥½åœ°é€‚åº”ç°æœ‰çš„ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œå‡å°‘äº†ä¸é˜²ç«å¢™å’Œä»£ç†æœåŠ¡å™¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚

**2ã€ğŸ”„çµæ´»çš„ä¼ è¾“æ¨¡å¼**

æœåŠ¡å™¨å¯ä»¥æ ¹æ®è¯·æ±‚çš„ç±»å‹å’Œå†…å®¹ï¼Œçµæ´»åœ°é€‰æ‹©è¿”å›æ ‡å‡†çš„ HTTP å“åº”æˆ–é€šè¿‡ SSE æµå¼ä¼ è¾“ï¼š

* **æŒ‰éœ€æµå¼ä¼ è¾“**ï¼šå¯¹äºç®€å•çš„è¯·æ±‚ï¼Œå¯ä»¥è¿”å›ç›´æ¥çš„ HTTP å“åº”ï¼Œæ— éœ€å»ºç«‹é•¿è¿æ¥ã€‚

* **æ™ºèƒ½é™çº§**ï¼šåœ¨ç½‘ç»œæ¡ä»¶ä¸ä½³æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é™çº§åˆ°æ ‡å‡†çš„ HTTP æ¨¡å¼ã€‚

* **èµ„æºä¼˜åŒ–**ï¼šæ ¹æ®è¯·æ±‚çš„å¤æ‚æ€§åŠ¨æ€åˆ†é…æœåŠ¡å™¨èµ„æºï¼Œä»¥æé«˜æ•´ä½“æ•ˆç‡ã€‚

**3ã€ğŸ¤–å¼ºå¤§çš„ä¼šè¯ç®¡ç†**

å¼•å…¥äº†å…¨é¢çš„ä¼šè¯æœºåˆ¶ï¼Œä»¥æ”¯æŒçŠ¶æ€ç®¡ç†å’Œæ¢å¤ï¼š

* **ä¼šè¯ä¸€è‡´æ€§**ï¼šé€šè¿‡ Mcp-Session-Id å¤´ç¡®ä¿è·¨è¯·æ±‚çš„çŠ¶æ€ä¸€è‡´æ€§ã€‚

* **æ–­çº¿é‡è¿**ï¼šæ”¯æŒ Last-Event-ID æœºåˆ¶ï¼Œç¡®ä¿æ–­çº¿åæœªæ”¶åˆ°çš„æ¶ˆæ¯å¯ä»¥è¢«æ¢å¤ã€‚

* **çŠ¶æ€æ¢å¤**ï¼šå…è®¸å®¢æˆ·ç«¯åœ¨é‡æ–°è¿æ¥æ—¶æ¢å¤ä¹‹å‰çš„ä¼šè¯çŠ¶æ€ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

**Streamable HTTP åªéœ€ç»´æŠ¤ä¸€ä¸ªç‹¬ç«‹è¿æ¥ï¼Œé™ä½äº†å¤æ‚åº¦**ï¼š

![å›¾ç‰‡](/images/posts/mcp/6.png)

##### HTTP + SSE VS Streamable HTTP

**1ã€âš–ï¸ç¨³å®šæ€§**

**TCPè¿æ¥æ¬¡æ•°æ¯”è¾ƒ**

SSE Server çš„ SSE è¿æ¥æ— æ³•å¤ç”¨ä¸”éœ€è¦é•¿æœŸç»´æŠ¤ã€‚é«˜å¹¶å‘éœ€æ±‚ä¹Ÿå°†å¯¼è‡´ TCP è¿æ¥æ•°é‡æ€¥å‰§å¢åŠ ï¼Œè€Œ Streamable HTTP åè®®å¯ä»¥ç›´æ¥è¿”å›å“åº”ï¼Œå¹¶å¤ç”¨åŒä¸€ä¸ª TCP è¿æ¥å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚å…¶ TCP è¿æ¥æ•°æœ€å¤šä»…è¾¾åˆ°å‡ åä¸ªï¼Œä¸”æ•´ä½“æ‰§è¡Œæ—¶é—´ä»…ä¸º SSE Server çš„å››åˆ†ä¹‹ä¸€ã€‚

* HTTP + SSEï¼š éœ€è¦ç»´æŠ¤å¤§é‡é•¿è¿æ¥ï¼ŒTCP è¿æ¥æ•°éšæ—¶é—´æ¨ç§»æŒç»­å¢é•¿ã€‚

* Streamable HTTPï¼šæŒ‰éœ€å»ºç«‹è¿æ¥ï¼Œä¿æŒä½æ°´å¹³çš„ TCP è¿æ¥æ•°ã€‚

![å›¾ç‰‡](/images/posts/mcp/7.png)

è¯·æ±‚æˆåŠŸç‡æ¯”è¾ƒ

* HTTP + SSEï¼š éšç€å¹¶å‘ç”¨æˆ·æ•°çš„å¢åŠ ï¼ŒæˆåŠŸç‡æ˜¾è‘—ä¸‹é™ã€‚

* Streamable HTTPï¼šå³ä½¿åœ¨é«˜å¹¶å‘æ¡ä»¶ä¸‹ä¹Ÿèƒ½ä¿æŒç›¸å¯¹è¾ƒé«˜çš„æˆåŠŸç‡ã€‚

![å›¾ç‰‡](/images/posts/mcp/8.png)

**2ã€ğŸš€æ€§èƒ½**

**å“åº”æ—¶é—´æ¯”è¾ƒï¼š**

* Streamable HTTP çš„å¹³å‡å“åº”æ—¶é—´æ›´çŸ­ï¼Œå“åº”æ—¶é—´æ³¢åŠ¨è¾ƒå°ï¼Œä¸”éšå¹¶å‘ç”¨æˆ·æ•°å¢åŠ ï¼Œå“åº”æ—¶é—´å¢é•¿æ›´ä¸ºå¹³ç¨³ã€‚

* HTTP + SSE çš„å¹³å‡å“åº”æ—¶é—´æ›´é•¿ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å“åº”æ—¶é—´æ³¢åŠ¨æ˜¾è‘—

![å›¾ç‰‡](/images/posts/mcp/9.png)

**3ã€ğŸ§©å¤æ‚åº¦**

Streamable HTTP åŒæ—¶æ”¯æŒæ— çŠ¶æ€å’Œæœ‰çŠ¶æ€æœåŠ¡ã€‚å½“å‰å¤§å¤šæ•°åœºæ™¯å¯ä»¥é€šè¿‡æ— çŠ¶æ€çš„ Streamable HTTP è§£å†³ã€‚é€šè¿‡å¯¹æ¯”ä¸¤ç§ä¼ è¾“è§£å†³æ–¹æ¡ˆçš„å®¢æˆ·ç«¯å®ç°ä»£ç ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹å‡ºæ— çŠ¶æ€ Streamable HTTP å®¢æˆ·ç«¯å®ç°çš„ç®€æ´æ€§ã€‚

**HTTP + SSE å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç ï¼š**

```python
class SSEClient:
    def __init__(self, url: str, headers: dict = None):
        self.url = url
        self.headers = headers or {}
        self.event_source = None
        self.endpoint = None

    async def connect(self):
        # 1. Establish SSE connection
        async with aiohttp.ClientSession(headers=self.headers) as session:
            self.event_source = await session.get(self.url)

            # 2. Handle connection events
            print('SSE connection established')

            # 3. Handle message events
            async for line in self.event_source.content:
                if line:
                    message = json.loads(line)
                    await self.handle_message(message)

                    # 4. Handle errors and reconnect
                    if self.event_source.status != 200:
                        print(f'SSE error: {self.event_source.status}')
                        await self.reconnect()

    async def send(self, message: dict):
        # Need an additional POST request to send the message
        async with aiohttp.ClientSession(headers=self.headers) as session:
            async with session.post(self.endpoint, json=message) as response:
                return await response.json()

    async def handle_message(self, message: dict):
        # Handle the received message
        print(f'Received message: {message}')

    async def reconnect(self):
        # Implement reconnection logic
        print('Attempting to reconnect...')
        await self.connect()
```

**Streamable HTTP å®¢æˆ·ç«¯ç¤ºä¾‹ä»£ç ï¼š**

```python
class StreamableHTTPClient:
    def __init__(self, url: str, headers: dict = None):
        self.url = url
        self.headers = headers or {}

    async def send(self, message: dict):
        # 1. Send a POST request
        async with aiohttp.ClientSession(headers=self.headers) as session:
            async with session.post(self.url, json=message,
                                    headers={'Content-Type': 'application/json'}
                                   ) as response:
                # 2. Handle the response
                if response.status == 200:
                    returnawait response.json()
                else:
                    raise Exception(f'HTTP error: {response.status}')
```

ä»¥ä¸Šæ˜¯ MCP ä¼ è¾“æœºåˆ¶çš„ç›¸å…³ä»‹ç»ã€‚éšç€ MCP åè®®çš„æŒç»­å‘å±•ï¼ŒStreamable HTTP ä¼ è¾“æœºåˆ¶çš„å¼•å…¥æ ‡å¿—ç€åè®®å‘æ›´é«˜æ•ˆã€æ›´ç¨³å®šæ–¹å‘è¿ˆå‡ºäº†é‡è¦ä¸€æ­¥ã€‚é€šè¿‡ç»Ÿä¸€çš„ç«¯ç‚¹è®¾è®¡ã€çµæ´»çš„ä¼ è¾“æ¨¡å¼å’Œå¼ºå¤§çš„ä¼šè¯ç®¡ç†ï¼ŒStreamable HTTP è§£å†³äº† HTTP+SSE æ–¹æ¡ˆçš„è¯¸å¤šç—›ç‚¹ï¼Œä¸º AI åº”ç”¨æä¾›äº†æ›´å¯é çš„é€šä¿¡åŸºç¡€ã€‚
